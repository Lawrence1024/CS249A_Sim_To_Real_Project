#VRML_SIM R2023a utf8

EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023a/projects/objects/backgrounds/protos/TexturedBackground.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023a/projects/objects/backgrounds/protos/TexturedBackgroundLight.proto"
IMPORTABLE EXTERNPROTO "../protos/ScenicObject.proto"
IMPORTABLE EXTERNPROTO "../protos/ScenicObjectWithPhysics.proto"

WorldInfo {
  gravity 9.81
  basicTimeStep 16
  contactProperties [
    ContactProperties {
      material1 "wheel_material"
      material2 "ground_material"
      coulombFriction 0.8
      bounce 0
    }
  ]
}
Viewpoint {
  orientation -0.19729161510865992 0.07408415124219735 0.977541588446517 2.4380019050245862
  position 2 2 2
}
TexturedBackground {
}
TexturedBackgroundLight {
}
Robot {
  name "Supervisor"
  controller "scenic_supervisor"
  customData "../../../line_following.scenic"
  supervisor TRUE
  children [
    Emitter {
      channel 1
    }
    Receiver {
      channel 1
    }
  ]
}
DEF GROUND Solid {
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.9 0.9 0.9
        roughness 0.5
        metalness 0
      }
      geometry DEF GROUND_PLANE Plane {
        size 10 10
      }
    }
  ]
  boundingObject USE GROUND_PLANE
  locked TRUE
  contactMaterial "ground_material"
}
# Black line for following
DEF LINE Shape {
  appearance PBRAppearance {
    baseColor 0.1 0.1 0.1
    roughness 0.5
    metalness 0
  }
  geometry Box {
    size 0.02 5 0.001
  }
}
DEF LINE_FOLLOWING_ROBOT Robot {
  translation 0 0 0.03
  rotation 0 0 1 1.5708
  controller "simple_robot_controller"
  boundingObject Cylinder {
    height 0.036
    radius 0.048
  }
  physics Physics {
    density 1000
    mass 0.1
  }
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.2 0.2 0.8
        roughness 0.5
        metalness 0
      }
      geometry Cylinder {
        height 0.036
        radius 0.048
      }
    }
    # Left wheel
    HingeJoint {
      jointParameters HingeJointParameters {
        axis 0 1 0
        anchor 0 0.048 -0.016
      }
      device [
        RotationalMotor {
          name "leftMotor"
        }
      ]
      endPoint Solid {
        translation 0 0.03 -0.016
        rotation 1 0 0 1.5708
        name "leftWheel"
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 1 1 0
            }
            geometry Cylinder {
              height 0.007
              radius 0.016
            }
          }
        ]
        boundingObject Cylinder {
          height 0.007
          radius 0.016
        }
        physics Physics {
          density 100
        }
        contactMaterial "wheel_material"
      }
    }
    # Right wheel
    HingeJoint {
      jointParameters HingeJointParameters {
        axis 0 1 0
        anchor 0 -0.048 -0.016
      }
      device [
        RotationalMotor {
          name "rightMotor"
        }
      ]
      endPoint Solid {
        translation 0 -0.03 -0.016
        rotation 1 0 0 1.5708
        name "rightWheel"
        children [
          Shape {
            appearance PBRAppearance {
              baseColor 1 1 0
            }
            geometry Cylinder {
              height 0.007
              radius 0.016
            }
          }
        ]
        boundingObject Cylinder {
          height 0.007
          radius 0.016
        }
        physics Physics {
          density 100
        }
        contactMaterial "wheel_material"
      }
    }
    # IR sensors
    DistanceSensor {
      translation 0.03 0.03 0
      rotation 0 0 1 0
      name "leftLine"
      type "infra-red"
    }
    DistanceSensor {
      translation -0.03 0.03 0
      rotation 0 0 1 0
      name "rightLine"
      type "infra-red"
    }
    DistanceSensor {
      translation 0 0.05 0
      rotation 0 0 1 0
      name "centerLine"
      type "infra-red"
    }
    # Communication devices for Scenic control
    Emitter {
      channel 1
    }
    Receiver {
      channel 1
    }
  ]
}
